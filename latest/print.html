<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Matrix IRC Bridge</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="usage.html"><strong aria-hidden="true">2.</strong> Usage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="admin_room.html"><strong aria-hidden="true">2.1.</strong> Admin Room</a></li><li class="chapter-item expanded "><a href="room_commands.html"><strong aria-hidden="true">2.2.</strong> Room Commands</a></li><li class="chapter-item expanded "><a href="room_configuration.html"><strong aria-hidden="true">2.3.</strong> Room Configuration</a></li><li class="chapter-item expanded "><a href="irc_modes.html"><strong aria-hidden="true">2.4.</strong> IRC Modes</a></li></ol></li><li class="chapter-item expanded "><a href="bridge_setup.html"><strong aria-hidden="true">3.</strong> Setup</a></li><li class="chapter-item expanded "><a href="administrators_guide.html"><strong aria-hidden="true">4.</strong> Administrators Guide</a></li><li class="chapter-item expanded "><a href="irc_operators.html"><strong aria-hidden="true">5.</strong> IRC Operators</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Matrix IRC Bridge</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>This book describes how to use the Matrix IRC bridge, giving an overview of functions for users and server administrators. If you
believe there are errors or omissions in the book, please open an issue on <a href="https://github.com/matrix-org/matrix-appservice-irc/issues">GitHub</a>
or create a PR.</p>
<p>For an overview of the bridge, see the <a href="https://github.com/matrix-org/matrix-appservice-irc">README.md</a></p>
<p>A community maintained wiki also exists which can be found <a href="https://github.com/matrix-org/matrix-appservice-irc/wiki">here</a></p>
<p>The documentation is built from source and can be found in <a href="https://github.com/matrix-org/matrix-appservice-irc/tree/develop/docs">the GitHub repo</a></p>
<h1 id="using-the-bridge"><a class="header" href="#using-the-bridge">Using the bridge</a></h1>
<p>This chapter describes how to use the bridge and is intended for new or experienced Matrix
users.</p>
<h2 id="getting-connected"><a class="header" href="#getting-connected">Getting connected</a></h2>
<p>The IRC bridge will dynamically connect you to IRC when you start interacting with an IRC bridged room.
Some bridges, such as matrix.org, will connect you to IRC and join you to a channel the moment you join
the Matrix room. Others will only connect you to IRC when you attempt to send a message to a Matrix channel.</p>
<p>Once you are connected to IRC, any joins you make to rooms connected to IRC will be replicated as joins to the
IRC channel. By default your nickname will be <code>YourDisplayname-M</code>, but some bridges may alter this default
by using a <code>[m]</code> suffix instead.</p>
<h3 id="joining-a-channel"><a class="header" href="#joining-a-channel">Joining a channel</a></h3>
<p>Joining a public channel over the bridge is as easy as joining an alias, for instance:</p>
<p><code>#freenode_#python:matrix.org</code> maps to the <code>#python</code> channel on Freenode.</p>
<h3 id="private-messaging"><a class="header" href="#private-messaging">Private Messaging</a></h3>
<p>Sending a Private Message (PM) to an IRC user means starting a conversation with <code>@freenode_Alice:matrix.org</code>,
which maps to the nickname <code>Alice</code> on Freenode.</p>
<p>If a PM is sent from the IRC side, it will either appear in your existing PM room or you will be invited
to a new room.</p>
<p>The room alias and user formats may differ depending on the bridge you are using, so be sure to check with the
server administrator if the above defaults are not working for you. Server administrators can check
<a href="https://github.com/matrix-org/matrix-appservice-irc/blob/develop/config.sample.yaml">config.sample.yaml</a> for
instructions on how to change the templates for users and channels.</p>
<p>The wiki contains a <a href="https://github.com/matrix-org/matrix-appservice-irc/wiki/Bridged-IRC-networks">list of public IRC networks</a>
including alias and user_id formats.</p>
<h3 id="customising-your-experience"><a class="header" href="#customising-your-experience">Customising your experience</a></h3>
<p>You may also want to customise your nickname or set a password to authenticate with services, you
can do this by PMing the bridge bot user. E.g. the matrix.org freenode bridge user is <code>@appservice-irc:matrix.org</code>.</p>
<pre><code>!nick Alice
!storepass MySecretPassword
</code></pre>
<p>More commands can be found in the <a href="./admin_room.html">Admin Room</a> section.</p>
<h2 id="authentication"><a class="header" href="#authentication">Authentication</a></h2>
<p>Most networks provide a mechanism for one to authenticate themselves. You can do this manually by messaging NickServ
or by providing a password to the bridge itself. See the <a href="./admin_room.html">Admin Room</a> section for help.</p>
<h2 id="message-behaviours"><a class="header" href="#message-behaviours">Message behaviours</a></h2>
<p>Messages from IRC to Matrix appear in roughly as you'd expect them to. Emotes (<code>/me</code> text) are applied as Matrix supports
it, and mIRC format colours are applied too. The IRC bridge makes an attempt to replace nicknames in sent messages with 
user mention &quot;pills&quot;.</p>
<p><img src="images/irc_mentions.png" alt="An illustration of the IRC mentions feature" /></p>
<h3 id="matrix---irc-formatting"><a class="header" href="#matrix---irc-formatting">Matrix -&gt; IRC formatting</a></h3>
<p>Messages from Matrix are often richer than their IRC counterparts, as Matrix has support for sending HTML, files, edits and replies.</p>
<p>Basic formatting is supported such as <strong>bolding</strong> and <em>italics</em> but other formats are discarded. Messages that exceed the maximum
size of an IRC message <em>or</em> a message that contains newlines will be split into two or more messages. The configuration value
<code>lineLimit</code> sets the maximum permittied number of messages to be sent before the whole message is stored as a file and sent as a link.</p>
<p>For example:</p>
<pre><code class="language-irc">&gt; Half-Shot sent a long message: &lt;https://matrix.org/_matrix/media/r0/download/matrix.org/fooobar/message.txt&gt;
</code></pre>
<p>Files are sent as textual links such as:</p>
<pre><code class="language-irc">&gt; Half-Shot uploaded an image: meme.gif (1358KiB) &lt; https://matrix.org/_matrix/media/r0/download/half-shot.uk/fooobar/meme.gif &gt;
</code></pre>
<p>Edits are sent with a fallback star:</p>
<pre><code class="language-irc">&gt; Half-Shot: foo
&gt; Half-Shot: * foobar
</code></pre>
<p>Replies are sent with context:</p>
<pre><code class="language-irc">&gt; Half-Shot: foo
&gt; &lt;Half-Shot &quot;foo&quot;&gt; bar
</code></pre>
<p>Reactions or other non-message events are not sent presently.</p>
<h2 id="encryption"><a class="header" href="#encryption">Encryption</a></h2>
<p>Presently, the bridge cannot work in an E2EE room. The bridge will leave any room that has encryption enabled. This is because
the bridge does not know how to read encrypted events and so far no work has been started to support this. IRC is not capable of
relaying E2E messages to IRC clients and as such the bridge would have to decrypt messages from Matrix and encrypt messages from
IRC. As such, the team has chosen not to support encrypted Matrix rooms at this time.</p>
<h1 id="admin-room"><a class="header" href="#admin-room">Admin Room</a></h1>
<p>Most bridges will send you an invite to an admin room once you connectto control your connection 
to IRC, but larger bridges like matrix.org's Freenode bridge will not (you will need to start a
conversation with the bot manually).</p>
<h2 id="bot-commands"><a class="header" href="#bot-commands">Bot Commands</a></h2>
<p>The admin room allows you to send commands to a room to manipulate your IRC session. </p>
<p>Some commands take a <code>[irc.example.net]</code> which lets you choose which IRC network to direct the
request to, as some bridges host multiple IRC networks. Typically matrix.org bridges only host
one network.</p>
<h3 id="join"><a class="header" href="#join"><code>!join</code></a></h3>
<p><code>!join [irc.example.net] #channel [key]</code></p>
<p>Joins a channel on the IRC side and invites you to the Matrix room. This command will create a new
portal room if a room doesn't exist. This is useful where you cannot with the alias syntax (e.g. the channel requires a key).</p>
<h3 id="cmd"><a class="header" href="#cmd"><code>!cmd</code></a></h3>
<p><code>!cmd [irc.example.net] COMMAND [arg0 [arg1 [...]]]</code></p>
<p>Send a raw command through the IRC connection. This is useful for making MODE changes to yourself
or to a channel if you have operator priviledges. Note that this command will not produce any response
text, so commands will happen silently.</p>
<h3 id="whois"><a class="header" href="#whois"><code>!whois</code></a></h3>
<p><code>!whois [irc.example.net] NickName|@alice:matrix.org</code></p>
<p>A powerful command to either lookup a nickname <em>or</em> a Matrix UserID and return information about that user.</p>
<h3 id="storepass"><a class="header" href="#storepass"><code>!storepass</code></a></h3>
<p><code>!storepass [irc.example.net] passw0rd</code></p>
<p>Store a password, or a <code>username:password</code> combination to be sent as a PASS command on connection to the server.
This will also reconnect you to IRC so the PASS command can be sent.</p>
<p><strong>This action will store your password in encrypted form on the IRC bridge</strong>, so be sure to use a unique password
for the IRC service. </p>
<h3 id="removepass"><a class="header" href="#removepass"><code>!removepass</code></a></h3>
<p><code>!removepass [irc.example.net]</code></p>
<p>Remove your stored password, will NOT reconnect you.</p>
<h3 id="listrooms"><a class="header" href="#listrooms"><code>!listrooms</code></a></h3>
<p><code>!listrooms [irc.example.net]</code></p>
<p>List all the Matrix rooms that you are joined to which are also connected to IRC.</p>
<h3 id="quit"><a class="header" href="#quit"><code>!quit</code></a></h3>
<p>QUITs you from all connected networks AND <strong>kicks you from all IRC rooms</strong> (except DMs). This is to avoid
leaking history to your Matrix account while not being visible to IRC users. This command will not remove
your password or stored data with the bridge. Ask the owner of the bridge to remove that data for you.</p>
<h3 id="nick"><a class="header" href="#nick"><code>!nick</code></a></h3>
<p><code>!nick [irc.example.net] nick</code></p>
<p>Set your nickname for your IRC conenction and persist it across restarts. If the nickname clashes with another
user's nickname, this will fail.</p>
<h3 id="feature"><a class="header" href="#feature"><code>!feature</code></a></h3>
<p><code>!feature feature-name [true/false/default]</code></p>
<p>Enable or disable a feature for your account. Set it to <code>true</code> to enable the feature, <code>false</code> to disable it, or <code>default</code>
to use the default based upon the bridge config.</p>
<p>Currently, the features you can use are:</p>
<ul>
<li><code>mentions</code> - Determine whether IRC users can mention you on the IRC bridge. Note, that this will only stop mention text being turned
into pills. See <a href="usage.html#message-behaviours">this section</a> for an explanation of this feature.</li>
</ul>
<h3 id="bridgeversion"><a class="header" href="#bridgeversion"><code>!bridgeversion</code></a></h3>
<p>Prints the current version of the bridge.</p>
<p>The bridge bot allows you to control your IRC connection through various bot commands. Some
commands are reserved for bridge administrators, which can be configured in the config file.</p>
<h3 id="plumb"><a class="header" href="#plumb"><code>!plumb</code></a></h3>
<p><code>!plumb !room:example.com irc.network.net #channel</code></p>
<p><em>This command only works for bridge administrators</em></p>
<p>This command allows you to plumb a IRC channel into a room without using the HTTP provisioning API. This command does NOT 
validate that you have permission to do this on the IRC channel so please take care to ensure that the IRC channel is
aware of your actions.</p>
<p>You must invite the bridge bot into the Matrix room for this to work.</p>
<h3 id="unlink"><a class="header" href="#unlink"><code>!unlink</code></a></h3>
<p><code>!unlink !room:example.com irc.network.net #channel</code></p>
<p><em>This command only works for moderators of a bridged Matrix room and bridge administrators</em></p>
<p>This command allows you to unlink a IRC channel from a room. Users are only able to remove links for rooms they are a moderator in (power level of 50 or greater). Administrators of the bridge are able to remove links from any room.</p>
<h3 id="help"><a class="header" href="#help"><code>!help</code></a></h3>
<p>Prints a list of commands for the bridge.</p>
<h2 id="room-commands"><a class="header" href="#room-commands">Room Commands</a></h2>
<p>Some commands to the IRC bridge can be sent inline into any bridged Matrix room. This is
handy if you are also bridging to Telegram or Slack and do not have the ability to DM
the bridge bot in order to make changes to your session.</p>
<h2 id="irc-nick-nickname"><a class="header" href="#irc-nick-nickname"><code>!irc nick $nickname</code></a></h2>
<p>Change your nickname on the IRC server that the room is connected to.</p>
<h1 id="room-configuration"><a class="header" href="#room-configuration">Room Configuration</a></h1>
<p>You can now configure certain options on a per-room basis from within your Matrix client. Currently
this requires a bit of technical know-how as no clients expose an interface to changing the
bridge configuration.</p>
<h2 id="the-orgmatrixappservice-ircconfig-event"><a class="header" href="#the-orgmatrixappservice-ircconfig-event">The <code>org.matrix.appservice-irc.config</code> event</a></h2>
<p>The bridge allows room moderators to create a state event in the room to change the way the bridge
behaves in that room. </p>
<p>In Element you can modify the room state by:</p>
<ul>
<li>Opening the room you wish to configure.</li>
<li>Typing <code>/devtools</code>.</li>
<li>Click Explore Room State.</li>
<li>Look for the <code>org.matrix.appservice-irc.config</code> event.</li>
<li>You should be able to click Edit to edit the content, and then hit Send to adjust the config.</li>
</ul>
<p>If an event does not exist yet, you can instead do:</p>
<ul>
<li>Typing <code>/devtools</code>.</li>
<li>Click Send Custom Event.</li>
<li>Click the Event button to change the type to a <strong>State Event</strong>.</li>
<li>The event type must be <code>org.matrix.appservice-irc.config</code></li>
<li>The state key can be left blank.</li>
<li>Enter the <code>Event Content</code> as a JSON object. The schema is described in the following section.</li>
<li>You may now hit Send to apply the config.</li>
</ul>
<h2 id="configuration-options"><a class="header" href="#configuration-options">Configuration Options</a></h2>
<h3 id="linelimit"><a class="header" href="#linelimit"><code>lineLimit</code></a></h3>
<p>Type: <code>number</code></p>
<p>This allows you to modify the minimum number of lines permitted in a room before the
message is pastebinned. The setting is analogous to the <code>lineLimit</code> config option in
the bridge config file.</p>
<h1 id="irc-modes"><a class="header" href="#irc-modes">IRC Modes</a></h1>
<p>This chapter explains how various IRC channel modes are interpteted by the bridge, and how you can best configure your
channels to work well with the bridge.</p>
<p>Note: While the bridge tries to follow the RFCs where possible, due to the somewhat fragmented nature of IRC the bridge is
designed for maximum compatibility with <a href="https://github.com/freenode/ircd-seven">Freenode's IRCd</a>.</p>
<h2 id="user-modes-to-power-levels"><a class="header" href="#user-modes-to-power-levels">User modes to power levels</a></h2>
<p>User modes are mapped to certain power levels on Matrix. For those unaware, Matrix power levels typically range between
0-100 where zero represents a user that may only speak and 100 is an admin of the room (although these are modifiable).</p>
<p>By default the bridge maps users like so</p>
<pre><code class="language-yaml"># taken from config.sample.yaml
modePowerMap:
    o: 50
    v: 1
</code></pre>
<p>An operator on the IRC side of the bridge will be given moderator privileges (PL50) and a voiced user will be given
PL1. In <code>+m</code> (moderated) rooms, users who are not voiced cannot speak and so the Matrix room will not allow users with
PL0 (that is, without +v) to speak.</p>
<p>The IRC bridge admin can customise this power level mapping to however they see fit.</p>
<h2 id="bans-invite-only-and-registered-only-b--i--r"><a class="header" href="#bans-invite-only-and-registered-only-b--i--r">Bans, Invite only and Registered only (+b / +i / +r)</a></h2>
<p>The IRC bridge will kick a Matrix user on join if they are not able to join the IRC channel. This means if the IRC
user is banned, the room is invite only (and the user has not been invited) or the channel is registered only then
the user will not be able to join it. A reason is given in the Matrix ban, and a more verbose error is given in the
user's admin room.</p>
<h3 id="invite-exemption-i"><a class="header" href="#invite-exemption-i">Invite exemption (+I)</a></h3>
<p>Some communties prefer to keep their channels closed but allow the bridge to access the channel. It is trivial to do
this by using the <code>+I</code> channel mode. The format is the same as an <a href="https://freenode.net/kb/answer/extbans">extban</a>.</p>
<p>For example to allow matrix.org bridge users to access your invite-only channel, you would do:</p>
<pre><code>/mode #the-secret-cookies +I !@gateway/shell/matrix.org/*
</code></pre>
<h2 id="s-secret"><a class="header" href="#s-secret">+s (Secret)</a></h2>
<p>By default the IRC bridge will automatically insert any newly joined rooms into the homeserver's room directory.
The +s mode will mark the channel as secret and the bridge will not show it in the
directory. The room will still be joinable however.</p>
<h2 id="key-protected-k"><a class="header" href="#key-protected-k">Key protected (+k)</a></h2>
<p>If a channel is protected by a key, it cannot be entered by joining via an alias. Instead you may join by using
the <a href="admin_room.html#join"><code>!join</code></a> command. Be aware that the bridge purposefully does not store channel keys in
the database as a security precaution so you should be expected to do this again on bridge restart.</p>
<h2 id="channel-forwarding-f"><a class="header" href="#channel-forwarding-f">Channel Forwarding (+f)</a></h2>
<p>Channel forwarding is presently unsupported, see https://github.com/matrix-org/matrix-appservice-irc/issues/214
for information and updates.</p>
<h1 id="bridge-setup"><a class="header" href="#bridge-setup">Bridge Setup</a></h1>
<p>This guide is written for server administrators who would like to set up their own IRC bridge to one or more networks.</p>
<h2 id="before-setting-up"><a class="header" href="#before-setting-up">Before setting up</a></h2>
<p>We recommend using Node.JS <code>v14</code> or greater when setting up the bridge, as we use <code>worker_threads</code> to handle 
some of the traffic for larger bridges.</p>
<p>If you wish to use Node.JS v10, you should enable the <code>--experimental-worker</code> on the commandline.
Please note that we offer no support for Node 10.</p>
<p>You should also ensure you have a recent Matrix homeserver that you have permission to bridge to. This can 
either be your own, or one that you have the ability to setup Application Services with.</p>
<p>Finally <strong>you should seek permission from the operator of the bridged IRC network before running this bridge.</strong>
<strong>Bridging may be against the IRC network's Terms of Use.</strong>. Failure to do so may get your bridge banned and 
your IP address blocked by the IRC network. Networks like Freenode will only allow 3 IRC connections from a 
single IP, so you should ask them for permission before bridging.</p>
<h2 id="1-installation"><a class="header" href="#1-installation">1. Installation</a></h2>
<h3 id="install-from-git-preferred"><a class="header" href="#install-from-git-preferred">Install from git (preferred)</a></h3>
<pre><code class="language-sh">git clone https://github.com/matrix-org/matrix-appservice-irc.git
cd matrix-appservice-irc
git checkout master # or 0.x.x to pin to a version
npm i
</code></pre>
<p>The bridge can now be started by: <code>node app.js</code></p>
<h3 id="global-install"><a class="header" href="#global-install">Global Install</a></h3>
<pre><code class="language-sh"># --global requires super user on most systems
$ npm install matrix-appservice-irc --global
</code></pre>
<h3 id="docker"><a class="header" href="#docker">Docker</a></h3>
<p>The bridge has a <a href="https://hub.docker.com/r/matrixdotorg/matrix-appservice-irc">Docker image</a>.</p>
<h2 id="2-configuration"><a class="header" href="#2-configuration">2. Configuration</a></h2>
<p>The bridge must be configured before it can be run. This tells the bridge where to find the homeserver
and how to bridge IRC channels/users.</p>
<ul>
<li>Copy <code>config.sample.yaml</code> to <code>config.yaml</code>.
<ul>
<li>For Docker, you will want to make a directory called <code>data</code> and store the <code>config.yaml</code> inside.</li>
</ul>
</li>
<li>Modify <code>config.yaml</code> to point to your homeserver and IRC network of choice.</li>
</ul>
<p>The sample config has detailed information about each option. Please read them carefully.</p>
<h2 id="3-database"><a class="header" href="#3-database">3. Database</a></h2>
<p>The bridge comes with support for either PostgreSQL or NEDB. PostgreSQL is preferred as it is faster,
easier to handle than flat files and allows you to inspect the state of it while the bridge is running.</p>
<p>Setting up PostgresSQL for the bridge is as easy as doing:</p>
<pre><code class="language-postgres">-- Authenticate with postgres, then
psql 'postgres://dbstring'
CREATE DATABASE ircbridge;
CREATE USER ircbridge WITH PASSWORD 's3cr3t';
GRANT ALL ON DATABASE ircbridge TO ircbridge;
-- Then modify your config.yaml to include the database connection string.
</code></pre>
<h2 id="4-registration"><a class="header" href="#4-registration">4. Registration</a></h2>
<p>The bridge needs to generate a registration file which can be passed to the homeserver to tell the
homeserver which Matrix events the bridge should receive.</p>
<p>Execute the following command:</p>
<pre><code>node app.js -r -f appservice-registration-irc.yaml -u &quot;http://where.the.appservice.listens:9999&quot; -c config.yaml -l my_bot
</code></pre>
<p>Change <code>-u &quot;http://localhost:8090&quot;</code> to whereever your Matrix server can contact this IRC bridge.
By changing the option <code>-l my_bot</code> you can modify the localpart of the bridge bot user. It contacts
Matrix users of your bridge to control their usage of the bridge (e.g. to change their nickname).</p>
<p>You should get something like:</p>
<pre><code>id: irc
hs_token: 82c7a893d020b5f28eaf7ba31e1d1091b12ebafc5ceb1b6beac2b93defc1b301
as_token: a66ae41f82b05bebfc9c259135ce1ce35c856000d542ab5d1f01e0212439d534
namespaces:
  users:
    - exclusive: true
      regex: '@irc_.*:yourhomeserverdomain'
  aliases:
    - exclusive: true
      regex: '#irc_.*:yourhomeserverdomain'
url: 'http://localhost:9999'
sender_localpart: appservice-irc
rate_limited: false
protocols:
  - irc
</code></pre>
<p>For Docker, copy the above to <code>data/appservice-registration-irc.yaml</code> and replace as necessary.</p>
<p><em>More information on the CLI args can be found by running</em> <code>$ node app.js --help</code></p>
<p>This will create a registration YAML file. Edit your <strong>homeserver</strong> config file (e.g. <code>homeserver.yaml</code>) to
point to this registration file:</p>
<pre><code class="language-yaml"># homeserver.yaml
app_service_config_files: [&quot;appservice-registration-irc.yaml&quot;]
</code></pre>
<h2 id="5-running"><a class="header" href="#5-running">5. Running</a></h2>
<p>Finally, the bridge can be run using the following command:</p>
<pre><code>$ node app.js -c config.yaml -f appservice-registration-irc.yaml -p 9999
</code></pre>
<p>Or for Docker:</p>
<pre><code># Remember to expose ports for metrics, debug API if you need to.
docker run --volume $PWD/data:/data --publish 9999 matrixdotorg/matrix-appservice-irc
</code></pre>
<h1 id="administrators-guide"><a class="header" href="#administrators-guide">Administrators Guide</a></h1>
<p>This document describes useful information when administering a bridge.</p>
<h2 id="advanced-configuration"><a class="header" href="#advanced-configuration">Advanced Configuration</a></h2>
<p>Typically the information given in <a href="./bridge_setup.html">Bridge Setup</a> is good enough for small
to medium sized bridges, but if you expect to handle extremely heavy IRC or Matrix traffic
then it might be looking at tweaking some of these options.</p>
<p>It should be noted that often the homeserver you have connected to the bridge will play a greater
role in the percieved performance of your bridge, as it is usually the bottleneck in either handing
(federated) traffic towards the bridge, or persisting and federating traffic from the bridge to users.</p>
<p>It is strongly advised that if you are suffering from performance issues, you should identify if there
are problems with your homeserver first.</p>
<h3 id="quit-debouncing"><a class="header" href="#quit-debouncing">Quit Debouncing</a></h3>
<p><a href="https://github.com/matrix-org/matrix-appservice-irc/blob/develop/config.sample.yaml#L93">Setting documentation</a></p>
<p>This setting handles the &quot;debouncing&quot; of quits when the server sees an extreme amount of QUIT events
from the IRC server. IRC servers often suffer from <a href="https://en.wikipedia.org/wiki/Netsplit">netsplits</a>
which manifest as many QUITs. The IRC bridge will handle one QUIT per <em>room</em>, so 5 users quitting from 5
rooms would manifest as 25 events. This can quickly overwhelm the bridge.</p>
<p>The quit debouner is often overkill for smaller bridges, but if you find that the bridge becomes overwhelmed
and unresponsive after a netsplit then it enabled. </p>
<h3 id="membership-syncing"><a class="header" href="#membership-syncing">Membership syncing</a></h3>
<p><a href="https://github.com/matrix-org/matrix-appservice-irc/blob/develop/config.sample.yaml#L222">Setting documentation</a></p>
<p>Typically it's wise to leave this setting on by default, as populating the memberlists on both sides of the
bridge leads to a more pleasant experience for users. However as the setting requires the constant adjustment
of the member lists on both sides of the bridge it can be more intensive on homeserver resources. You can
also adjust the membership settings of individual rooms or channels to lessen the effect.</p>
<h2 id="hot-reloading"><a class="header" href="#hot-reloading">Hot Reloading</a></h2>
<p>The bridge supports hot-reloading of the configuration file by sending a <code>SIGHUP</code> signal. Some configuration 
keys will not be reloaded as they are required to be static to avoid bridge instability. Unsupported keys are 
marked in <a href="https://github.com/matrix-org/matrix-appservice-irc/blob/develop/config.sample.yaml">config.sample.yaml</a>.
Hot reloading is useful as restarting the bridge will drop all IRC connections, so it's worth using this
method to avoid disruption.</p>
<p>Typically the process is as follows.</p>
<pre><code class="language-sh">$ ps -A | grep 'node'
31960 pts/7    00:00:13 node
# and then send the SIGHUP signal
$ kill -SIGHUP 31960
</code></pre>
<p>The logs will then mention <code>Bridge config was reloaded, applying changes</code> which confirms
that the reload has taken place.</p>
<h2 id="metrics--grafana"><a class="header" href="#metrics--grafana">Metrics / Grafana</a></h2>
<p>The bridge includes a prometheus compatible metrics endpoint which can be used to inspect
the state of the bridge. The repository also includes a grafana dashboard; more information
can be found in <a href="https://github.com/matrix-org/matrix-appservice-irc/blob/develop/contrib/GRAFANA.md">GRAFANA.md</a>.</p>
<h2 id="the-debug-api"><a class="header" href="#the-debug-api">The Debug API</a></h2>
<p>The Debug API allows you to perform administrative actions on the bridge such as killing a IRC
connection, inspecting connected users or unbridging a room. The API is currently loosely documented
over in <a href="%5Bhttps://github.com/matrix-org/matrix-appservice-irc/wiki/Debug-API">the GitHub wiki</a>.</p>
<p>This is not enabled by default.</p>
<h1 id="irc-operators"><a class="header" href="#irc-operators">IRC Operators</a></h1>
<p>This chapter describes useful information about the bridge for IRC operators or IRC users.</p>
<p>The IRC bridge provides each Matrix user with one IRC connection in order to bridge them &quot;natively&quot;
into the IRC network, as so they can largely be treated as real users. Due to the 1:1 connection system,
it is often useful that the IRCD network provides the bridge host with a more relaxed ILINE limit depending
on the number of Matrix users they'd expect to use the bridge.</p>
<h3 id="the-matrix-experience"><a class="header" href="#the-matrix-experience">The Matrix experience</a></h3>
<p>When a Matrix room is bridged to IRC, all users (by default) on the Matrix side will be provided with a connection
to the room and will show up in the user list on IRC. The IRC users will also appear as &quot;ghosts&quot; on the Matrix side,
bearing a Matrix ID like <code>@irc_alice:matrix.org</code>. This allows a &quot;native&quot; feeling so that users do not have to worry
about the complexities of the protocols. </p>
<p>However as with all bridges, the native feeling can catch IRC or Matrix users unaware when things do not bridge well
(such as replies/threading or reactions).</p>
<h3 id="the-m-m-suffix"><a class="header" href="#the-m-m-suffix">The [m]/-M suffix</a></h3>
<p>By default, the IRC bridge will append a <code>-M</code> to nicks for Matrix users. This is to avoid clashes with a users
real identity on IRC as well as to highlight that the users are on the bridge (and may not even know the conversation is bridged to IRC).
The user has the option to change this by going to the bot and sending a <code>!nick</code> command, so the suffix should not
be used as a blanket detection method.</p>
<h3 id="whois-information"><a class="header" href="#whois-information">Whois information</a></h3>
<p>The bridge sets various bits of information about users:</p>
<p>The realname of a user will be their MxID. By default this will look like:</p>
<pre><code>* [Half-Shot] (half-shoth@gateway/shell/matrix.org/x-foo): @Half-Shot:half-shot.uk
* [Half-Shot] moon.freenode.net :Atlanta, GA, US
* [Half-Shot] is using a secure connection
* [Half-Shot] is logged in as Half-Shot
* [Half-Shot] End of WHOIS list.
</code></pre>
<h3 id="portals-and-plumbed"><a class="header" href="#portals-and-plumbed">Portals and Plumbed</a></h3>
<p>A Matrix room can be connected to a IRC network in one of two ways:</p>
<ul>
<li>A portal room, which is a Matrix room created by the bridge on demand when a Matrix user attempts
to join an alias that does not yet exist. E.g. <code>#freenode_#myproject:matrix.org</code>. The bridge will
hold power over this room and grant moderator status (half-power) to any IRC operators or Matrix users
with IRC ops in the room.</li>
<li>A plumbed room (also known as provisioning). A Matrix user may create a room ahead of time for their
community and later on decide to &quot;plumb in&quot; IRC users to that room. They can do this via an interative
UI in Element, via the <code>!plumb</code> command or even via a HTTP endpoint. If done interatively, the bridge
has a verification process to ensure the user on the Matrix side has the blessing of the IRC ops first.
However, it's possible for the IRC bot to lack kick abilities in the room so kicks and bans may not be
bridged both ways.</li>
</ul>
<p>(This is explained in more depth at <a href="https://matrix.org/docs/guides/types-of-bridging#types-of-rooms">matrix.org</a>)</p>
<p>Additionally, a channel may be connected to one portal and multiple plumbed rooms without issue as the 
messages from Matrix users are replicated to the other rooms for them. We typically do not recommend
multiple points of entry to the channel due to the obvious confusion this causes.</p>
<h3 id="connection-failure"><a class="header" href="#connection-failure">Connection failure</a></h3>
<p>If a Matrix user fails to join a channel due to a ban, they are kicked from it. If the Matrix user
fails to get a connection to IRC at all, they are also kicked from any rooms they are part of. The exception
to this rule is if the bridge bot (which does the kicking) lacks permission to kick members of the room.</p>
<h3 id="line-limits"><a class="header" href="#line-limits">Line limits</a></h3>
<p>The IRC bridge allows admins to configure a maximum amount of lines that can be sent at a time to a channel
by a Matrix user. The Matrix spec allows events to be sent by users up to 65k in size, so with some margin for
event padding, a message could feasibly be over 64k in size. The Matrix spec has no limit on how many lines
a single message can have so to avoid this issue the bridge will &quot;pastebin&quot; any overly large message rather
than send the message line by line.</p>
<p>This can be confusing for IRC users, so we typically try to have a sensible limit to line count. By default
the bridge only pastebins a message that is over 3 lines in length to avoid problems, but this can be increased
at the discretion of the bridge admin.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
